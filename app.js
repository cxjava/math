var goappNav=function(){},goappOnUpdate=function(){},goappOnAppInstallChange=function(){};const goappEnv={GOAPP_INTERNAL_URLS:"null",GOAPP_ROOT_PREFIX:"/math",GOAPP_STATIC_RESOURCES_URL:"/math",GOAPP_VERSION:"517851aaa02e5e89ea671da59abfb6205db7df08"},goappLoadingLabel="加载中，请稍后⏳⌛️",goappWasmContentLengthHeader="";let goappServiceWorkerRegistration,deferredPrompt=null;goappInitServiceWorker(),goappWatchForUpdate(),goappWatchForInstallable(),goappInitWebAssembly();async function goappInitServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/math/app-worker.js");goappServiceWorkerRegistration=e,goappSetupNotifyUpdate(e),goappSetupAutoUpdate(e),goappSetupPushNotification()}catch(e){console.error("goapp service worker registration failed",e)}}function goappWatchForUpdate(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),deferredPrompt=e,goappOnAppInstallChange()})}function goappSetupNotifyUpdate(e){e.addEventListener("updatefound",t=>{const n=e.installing;n.addEventListener("statechange",e=>{if(!navigator.serviceWorker.controller)return;if(n.state!="installed")return;goappOnUpdate()})})}function goappSetupAutoUpdate(e){const t="600000";if(t==0)return;window.setInterval(()=>{e.update()},t)}function goappWatchForInstallable(){window.addEventListener("appinstalled",()=>{deferredPrompt=null,goappOnAppInstallChange()})}function goappIsAppInstallable(){return!goappIsAppInstalled()&&deferredPrompt!=null}function goappIsAppInstalled(){const e=window.matchMedia("(display-mode: standalone)").matches;return e||navigator.standalone}async function goappShowInstallPrompt(){deferredPrompt.prompt(),await deferredPrompt.userChoice,deferredPrompt=null}function goappGetenv(e){return goappEnv[e]}function goappSetupPushNotification(){navigator.serviceWorker.addEventListener("message",e=>{const t=e.data.goapp;if(!t)return;if(t.type!=="notification")return;goappNav(t.path)})}async function goappSubscribePushNotifications(e){try{const t=await goappServiceWorkerRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e});return JSON.stringify(t)}catch(e){return console.error(e),""}}function goappNewNotification(e){let t=JSON.parse(e);const o=t.title;delete t.title;let n=t.path;n||(n="/");const s=new Notification(o,t);s.onclick=()=>{goappNav(n),s.close()}}function goappKeepBodyClean(){const e=document.body,n=e.children.length,t=new MutationObserver(function(t){t.forEach(t=>{switch(t.type){case"childList":for(;e.children.length>n;)e.removeChild(e.lastChild);break}})});return t.observe(document.body,{childList:!0}),()=>t.disconnect()}async function goappInitWebAssembly(){const t=document.getElementById("app-wasm-loader");if(!goappCanLoadWebAssembly()){t.remove();return}let e=WebAssembly.instantiateStreaming;e||(e=async(e,t)=>{const n=await(await e).arrayBuffer();return await WebAssembly.instantiate(n,t)});const s=document.getElementById("app-wasm-loader-icon"),n=document.getElementById("app-wasm-loader-label");try{const s=e=>{n.innerText=goappLoadingLabel.replace("{progress}",e)};s(0);const o=new Go,i=await e(fetchWithProgress("/math/web/app.wasm",s),o.importObject);o.run(i.instance),t.remove()}catch(e){s.className="goapp-logo",n.innerText=e,console.error("loading wasm failed: ",e)}}function goappCanLoadWebAssembly(){if(/bot|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent))return!1;const e=new URLSearchParams(window.location.search);return e.get("wasm")!=="false"}async function fetchWithProgress(e,t){const n=await fetch(e);let s;try{s=n.headers.get(goappWasmContentLengthHeader)}catch{}(!goappWasmContentLengthHeader||!s)&&(s=n.headers.get("Content-Length"));const o=parseInt(s,10);let i=0;const a=function(e,n){t(Math.round(e*100/n))};var c,r=new Response(new ReadableStream({async start(e){for(t=n.body.getReader();;){var{done:r,value:s}=await t.read(),t;if(r){a(o,o);break}i+=s.byteLength,a(i,o),e.enqueue(s)}e.close()}},{status:n.status,statusText:n.statusText}));for(c of n.headers.entries())r.headers.set(c[0],c[1]);return r}